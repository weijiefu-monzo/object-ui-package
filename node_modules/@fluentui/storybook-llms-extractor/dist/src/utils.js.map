{"version":3,"sources":["../../src/utils.ts"],"sourcesContent":["import { mkdir, rm, writeFile, readFile } from 'node:fs/promises';\nimport { join, resolve, extname } from 'node:path';\nimport { existsSync } from 'node:fs';\n\nimport { type BrowserContext, type Page, chromium } from 'playwright';\nimport Turndown from 'turndown';\nimport { strikethrough, tables, taskListItems } from 'turndown-plugin-gfm';\n\nimport type { Args, StorybookComponentProp, StorybookComponent, StorybookStoreItem } from './types';\n\n/**\n * Get content type based on file extension\n */\nfunction getContentType(ext: string): string {\n  const contentTypes: Record<string, string> = {\n    '.html': 'text/html',\n    '.js': 'application/javascript',\n    '.css': 'text/css',\n    '.json': 'application/json',\n    '.png': 'image/png',\n    '.jpg': 'image/jpeg',\n    '.jpeg': 'image/jpeg',\n    '.gif': 'image/gif',\n    '.svg': 'image/svg+xml',\n    '.ico': 'image/x-icon',\n    '.woff': 'font/woff',\n    '.woff2': 'font/woff2',\n    '.ttf': 'font/ttf',\n    '.eot': 'application/vnd.ms-fontobject',\n  };\n\n  return contentTypes[ext] || 'application/octet-stream';\n}\n\n/**\n * Sets up static file serving using Playwright's page.route\n */\nasync function setupStaticRouting(page: Page, distPath: string) {\n  await page.route('**/*', async route => {\n    const url = new URL(route.request().url());\n    let filePath = url.pathname;\n\n    // Remove leading slash and resolve relative to distPath\n    if (filePath.startsWith('/')) {\n      filePath = filePath.substring(1);\n    }\n\n    // If no file extension, try to serve index.html\n    if (!extname(filePath)) {\n      filePath = join(filePath, 'index.html');\n    }\n\n    const fullPath = resolve(distPath, filePath);\n\n    try {\n      // Security check: ensure file is within distPath\n      if (existsSync(fullPath) && fullPath.startsWith(resolve(distPath))) {\n        const content = await readFile(fullPath);\n        const contentType = getContentType(extname(fullPath));\n\n        await route.fulfill({\n          status: 200,\n          contentType,\n          body: content,\n          headers: {\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n          },\n        });\n      } else {\n        await route.fulfill({\n          status: 404,\n          body: 'File not found',\n        });\n      }\n    } catch (error) {\n      console.error(`Error serving file ${fullPath}:`, error);\n      await route.fulfill({\n        status: 500,\n        body: 'Internal server error',\n      });\n    }\n  });\n}\n\n/**\n * Extracts data for all stories, including `MDX` stories.\n * Now uses Playwright routing instead of Express server.\n */\nexport async function extractStorybookData({ distPath }: Args): Promise<StorybookStoreItem[]> {\n  console.log(`▶️ Setting up Playwright with static file routing...`);\n\n  const browser = await chromium.launch();\n  const context = await browser.newContext({ bypassCSP: true });\n\n  try {\n    console.log(`✔️ Static file routing configured for ${distPath}`);\n\n    // Extract all stories from Storybook store\n    const storeItems = await extractAllStoriesFromStorybook(context, distPath);\n\n    // Extract content for all MDX pages\n    for (const item of storeItems) {\n      const stories = Object.values(item.stories);\n\n      if (stories.length > 0) {\n        for (const story of stories) {\n          if (story.parameters?.docsOnly) {\n            const pageUrl = `http://localhost/iframe.html?id=${story.id.replace('--page', '--docs')}`;\n            story.parameters.fullSource = await extractMDXStoryContentWithBrowser(pageUrl, context, distPath);\n          }\n        }\n      } else if (item.meta.parameters.fileName.endsWith('.mdx')) {\n        const pageUrl = `http://localhost/iframe.html?id=${item.meta.id.replace('--page', '--docs')}`;\n        item.stories[`${item.meta.id}`] = {\n          id: item.meta.id,\n          name: item.meta.title,\n          parameters: {\n            fullSource: await extractMDXStoryContentWithBrowser(pageUrl, context, distPath),\n            docsOnly: true,\n            docs: {},\n          },\n        };\n      }\n    }\n\n    console.log(`✔️ Extracted ${storeItems.length} stories from Storybook store.`);\n\n    return storeItems;\n  } finally {\n    if (browser) {\n      await browser.close();\n    }\n  }\n}\n\n/**\n * Storybook Client API store, contains methods to cache CSF files and cached items.\n */\ntype StorybookStoryStore = {\n  /**\n   * Caches all CSF files in the Storybook store.\n   * This method must be called before accessing `cachedCSFFiles`.\n   */\n  cacheAllCSFFiles: () => Promise<void>;\n  /**\n   * CSF files become available after `cacheAllCSFFiles()` is resolved.\n   **/\n  cachedCSFFiles?: Record<string, StorybookStoreItem>;\n};\n\n/**\n * Storybook Client API store, contains methods to cache CSF files.\n */\ninterface StorybookGlobals extends Window {\n  /**\n   * Storybook Client API, contains story store and other metadata.\n   * `storyStore` is used for Storybook 7, `storyStoreValue` for >= 8.\n   */\n  __STORYBOOK_PREVIEW__?: { storyStore: StorybookStoryStore } | { storyStoreValue: StorybookStoryStore };\n}\n\n/**\n * Extracts all stories from Storybook Client API store.\n */\nasync function extractAllStoriesFromStorybook(context: BrowserContext, distPath: string) {\n  const page = await context.newPage();\n\n  // Set up static file routing for this page\n  await setupStaticRouting(page, distPath);\n\n  await page.goto(`http://localhost/iframe.html`);\n\n  // Wait for the Storybook Client API to be loaded\n  await page.waitForFunction(() => {\n    return (window as StorybookGlobals).__STORYBOOK_PREVIEW__;\n  });\n\n  const stories: StorybookStoreItem[] = await page.evaluate(async () => {\n    /**\n     * Retrieves the Storybook story store from the global window object.\n     *\n     * @param window Storybook globals object\n     * @throws If unable to find Storybook preview or story store\n     */\n    const getStoryStore = (window: StorybookGlobals) => {\n      const preview = window.__STORYBOOK_PREVIEW__;\n\n      if (!preview) {\n        throw new Error('Unable to find Storybook preview');\n      }\n\n      if ('storyStore' in preview && preview.storyStore) {\n        return preview.storyStore;\n      }\n\n      if ('storyStoreValue' in preview && preview.storyStoreValue) {\n        return preview.storyStoreValue;\n      }\n\n      throw new Error('Unable to find Storybook story store');\n    };\n\n    const storyStore = getStoryStore(window);\n\n    await storyStore.cacheAllCSFFiles();\n\n    if (!storyStore.cachedCSFFiles) {\n      throw new Error('Unable to find cached CSF files in Storybook store');\n    }\n\n    return Object.values(storyStore.cachedCSFFiles);\n  });\n\n  await page.close();\n  return stories;\n}\n\n/**\n * Extracts `MDX` story content from a given URL using a browser.\n */\nasync function extractMDXStoryContentWithBrowser(url: string, context: BrowserContext, distPath: string) {\n  try {\n    const page = await context.newPage();\n\n    // Set up routing for this page\n    await setupStaticRouting(page, distPath);\n\n    console.log(`Extracting: \"${url}\"`);\n    await page.goto(url);\n    await page.waitForSelector('.sbdocs-content', { state: 'attached', timeout: 2000 });\n    const html = await page.locator('.sbdocs-content').innerHTML();\n    await page.close();\n    return convertHtmlToMarkdown(html);\n  } catch (error) {\n    console.error(`❌ Failed to extract: ${url}`, error);\n    return '';\n  }\n}\n\n/**\n * Converts HTML content to markdown.\n */\nexport async function convertHtmlToMarkdown(htmlContent: string) {\n  /**\n   * Disable HTML escaping for the Turndown service.\n   *\n   * https://github.com/mixmark-io/turndown?tab=readme-ov-file#overriding-turndownserviceprototypeescape\n   **/\n  Turndown.prototype.escape = (str: string) => str;\n\n  const turndown = new Turndown({\n    headingStyle: 'atx',\n    hr: '---',\n    bulletListMarker: '-',\n    codeBlockStyle: 'fenced',\n    fence: '```',\n    emDelimiter: '_',\n    strongDelimiter: '**',\n    linkStyle: 'inlined',\n  });\n\n  // GitHub Flavored Markdown rules\n  turndown.use([strikethrough, tables, taskListItems]);\n\n  // Code block rule\n  turndown.addRule('codeBlock', {\n    filter(node) {\n      return node.nodeName === 'PRE';\n    },\n    replacement(content, node) {\n      // Extract language from any element with class containing \"language-\"\n      const languageElement = node.querySelector('[class*=\"language-\"]');\n      let language = '';\n      if (languageElement) {\n        const classNames = languageElement.className.split(' ');\n        const languageClass = classNames.find((cls: string) => cls.startsWith('language-'));\n        if (languageClass) {\n          language = languageClass.replace('language-', '');\n        }\n      }\n\n      const normalizedContent = content.trim();\n\n      if (normalizedContent.startsWith('```')) {\n        return normalizedContent;\n      }\n\n      return `\\`\\`\\`${language}\\n${normalizedContent}\\n\\`\\`\\``;\n    },\n  });\n\n  // Remove unnecessary anchor links\n  turndown.addRule('removeAnchorLinks', {\n    filter(node) {\n      return (\n        node.tagName === 'A' &&\n        (node.getAttribute('href') === null ||\n          node.getAttribute('href')?.startsWith('#') ||\n          node.getAttribute('aria-hidden') === 'true' ||\n          node.getAttribute('tabindex') === '-1')\n      );\n    },\n    replacement: () => '',\n  });\n\n  // Remove other unnecessary elements\n  turndown.addRule('removeElements', {\n    filter: ['button', 'style', 'script', 'img'],\n    replacement: () => '',\n  });\n\n  // Convert to markdown\n  return turndown.turndown(htmlContent);\n}\n\n/**\n * Writes the summary file for all store items.\n */\nexport async function writeSummaryFile(args: Required<Args>, data: StorybookStoreItem[]) {\n  const summaryContent = generateSummaryContent(args, data);\n  await writeFile(join(args.distPath, 'llms.txt'), summaryContent.join('\\n'));\n  console.log(`✅ LLMs docs summary written to ${join(args.distPath, 'llms.txt')}`);\n}\n\n/**\n * Generates the summary file content from the storeItems array.\n */\nexport function generateSummaryContent(\n  { summaryTitle, summaryDescription, summaryBaseUrl, refs }: Required<Args>,\n  data: StorybookStoreItem[],\n) {\n  // Initialize summary array with header content\n  const summary: string[] = [\n    `# ${summaryTitle}`,\n    '',\n    '> **Note:** This is a summary overview using the LLMs.txt format (https://llmstxt.org/). Each section links to its full documentation file in plain text (.txt) format. Click any link below to view the detailed documentation for that section.',\n    '',\n    summaryDescription,\n    '',\n  ];\n\n  // Adds links to all components/pages\n  for (const item of data) {\n    let description = item.meta.parameters?.docs?.description?.component || '';\n    if (description) {\n      description = `: ${description.split('\\n')[0]}`;\n    }\n    summary.push(`- [${item.meta.title}](${summaryBaseUrl}/llms/${item.meta.id}.txt)${description}`);\n  }\n\n  // Adds links to all composed Storybook\n  if (refs && refs.length > 0) {\n    summary.push('');\n    summary.push('## Optional');\n    summary.push('');\n    for (const ref of refs) {\n      summary.push(`- [${ref.title}](${ref.url.replace(/\\/$/, '')}/llms.txt)`);\n    }\n    summary.push('');\n  }\n\n  return summary;\n}\n\n/**\n * Writes full markdown files for all components from `storeItems`.\n * For MDX pages, render only `fullSource`. For others, render title, description, props, and examples.\n */\nexport async function writeFullDocsFiles({ distPath }: Required<Args>, data: StorybookStoreItem[]) {\n  const llmsDir = join(distPath, 'llms');\n\n  // Clean up `llms` directory\n  await rm(llmsDir, { recursive: true, force: true });\n  await mkdir(llmsDir, { recursive: true });\n\n  for (const item of data) {\n    const filePath = join(llmsDir, `${item.meta.id}.txt`);\n    const content = generateFullFileContentFromStory(item);\n    await writeFile(filePath, content.join('\\n'));\n  }\n}\n\n/**\n * Generates the full markdown content for a given storybook story.\n */\nexport function generateFullFileContentFromStory(item: StorybookStoreItem) {\n  const stories = Object.values(item.stories);\n  const isMDXPage = stories.every(s => s.parameters?.docsOnly);\n\n  if (isMDXPage) {\n    return stories.map(s => s.parameters?.fullSource ?? '').filter(Boolean);\n  }\n\n  const content: string[] = [];\n  content.push(`# ${item.meta.title}`);\n  content.push('');\n  const description = extractStoryDescription(item);\n  if (description) {\n    content.push(description);\n    content.push('');\n  }\n  const props = extractComponentProps(item.meta.component);\n  if (props.length > 0) {\n    content.push('## Props');\n    content.push('');\n    content.push(...generateComponentPropsTable(props));\n    content.push('');\n  }\n\n  if (item.meta.subcomponents) {\n    content.push('## Subcomponents');\n    content.push('');\n\n    for (const [name, subcomponent] of Object.entries(item.meta.subcomponents)) {\n      const docgen = subcomponent?.__docgenInfo;\n      if (!docgen) {\n        continue;\n      }\n\n      content.push('');\n      content.push(`### ${name}`);\n      content.push('');\n      content.push(docgen.description ?? '');\n      content.push('');\n\n      const subcomponentProps = extractComponentProps(subcomponent);\n      if (subcomponentProps.length > 0) {\n        content.push('#### Props');\n        content.push('');\n        content.push(...generateComponentPropsTable(subcomponentProps));\n        content.push('');\n      }\n    }\n  }\n\n  const examples = Object.values(item.stories).map(s => ({\n    title: s.name,\n    description: s.parameters?.docs?.description?.story,\n    source: s.parameters?.fullSource ?? s.parameters.docs?.source?.originalSource,\n  }));\n  if (examples.length > 0) {\n    content.push('## Examples');\n    content.push('');\n    for (const ex of examples) {\n      content.push('');\n      content.push(`### ${ex.title}`);\n      content.push('');\n      if (ex.description) {\n        content.push(ex.description);\n        content.push('');\n      }\n      if (ex.source) {\n        content.push('```tsx');\n        content.push(ex.source.trim());\n        content.push('```');\n      }\n    }\n  }\n  return content;\n}\n\n/**\n * Converts a docgen type object to a readable string for markdown tables.\n */\nfunction stringifyPropType(type: StorybookComponentProp['type']): string {\n  if (!type) {\n    return '';\n  }\n  if (typeof type === 'string') {\n    return type;\n  }\n  if (typeof type === 'object' && type !== null && 'name' in type && typeof type.name === 'string') {\n    // Handle enums, unions, arrays, etc.\n    if (type.name === 'enum' && Array.isArray(type.value)) {\n      return type.value.map(v => (typeof v.value === 'string' ? v.value : JSON.stringify(v.value))).join(' ');\n    }\n    if (type.name === 'union' && Array.isArray(type.value)) {\n      return type.value.map(v => (typeof v.value === 'string' ? v.value : JSON.stringify(v.value))).join(' ');\n    }\n    if (type.name === 'array' && type.value) {\n      return `${stringifyPropType(type.value as StorybookComponentProp['type'])}[]`;\n    }\n    if (type.name === 'signature' && type.value?.[0]?.value === 'function') {\n      // Function signature\n      return 'function';\n    }\n    return type.name;\n  }\n  return JSON.stringify(type);\n}\n\n/**\n * Extracts the description from a storybook story.\n */\nfunction extractStoryDescription(story: StorybookStoreItem) {\n  return story.meta.parameters?.docs?.description?.component || undefined;\n}\n\n/**\n * Extracts the props from a storybook story.\n */\nfunction extractComponentProps(component?: StorybookComponent) {\n  const docgen = component?.__docgenInfo;\n  if (!docgen || !docgen.props) {\n    return [];\n  }\n  const props: StorybookComponentProp[] = [];\n  for (const [name, arg] of Object.entries(docgen.props)) {\n    if (name === 'children') {\n      continue;\n    }\n    props.push({\n      name,\n      description: arg.description || '',\n      type: arg.type,\n      defaultValue: typeof arg.defaultValue === 'string' ? arg.defaultValue : arg.defaultValue?.value || '',\n      required: arg.required,\n    });\n  }\n  return props;\n}\n\nfunction generateComponentPropsTable(props: StorybookComponentProp[]): string[] {\n  const content: string[] = [];\n\n  if (props.length === 0) {\n    return content;\n  }\n\n  content.push('');\n  content.push('| Name | Type | Required | Default | Description |');\n  content.push('|------|------|----------|---------|-------------|');\n  for (const prop of props) {\n    content.push(\n      `| ${[\n        `\\`${prop.name}\\``,\n        `\\`${stringifyPropType(prop.type)}\\``,\n        prop.required ? 'Yes' : 'No',\n        prop.defaultValue ?? '',\n        prop.description?.replace(/\\n/g, ' ') ?? '',\n      ].join(' | ')} |`,\n    );\n  }\n  content.push('');\n\n  return content;\n}\n"],"names":["convertHtmlToMarkdown","extractStorybookData","generateFullFileContentFromStory","generateSummaryContent","writeFullDocsFiles","writeSummaryFile","getContentType","ext","contentTypes","setupStaticRouting","page","distPath","route","url","URL","request","filePath","pathname","startsWith","substring","extname","join","fullPath","resolve","existsSync","content","readFile","contentType","fulfill","status","body","headers","error","console","log","browser","chromium","launch","context","newContext","bypassCSP","storeItems","extractAllStoriesFromStorybook","item","stories","Object","values","length","story","parameters","docsOnly","pageUrl","id","replace","fullSource","extractMDXStoryContentWithBrowser","meta","fileName","endsWith","name","title","docs","close","newPage","goto","waitForFunction","window","__STORYBOOK_PREVIEW__","evaluate","getStoryStore","preview","Error","storyStore","storyStoreValue","cacheAllCSFFiles","cachedCSFFiles","waitForSelector","state","timeout","html","locator","innerHTML","htmlContent","Turndown","prototype","escape","str","turndown","headingStyle","hr","bulletListMarker","codeBlockStyle","fence","emDelimiter","strongDelimiter","linkStyle","use","strikethrough","tables","taskListItems","addRule","filter","node","nodeName","replacement","languageElement","querySelector","language","classNames","className","split","languageClass","find","cls","normalizedContent","trim","tagName","getAttribute","args","data","summaryContent","writeFile","summaryTitle","summaryDescription","summaryBaseUrl","refs","summary","description","component","push","ref","llmsDir","rm","recursive","force","mkdir","isMDXPage","every","s","map","Boolean","extractStoryDescription","props","extractComponentProps","generateComponentPropsTable","subcomponents","subcomponent","entries","docgen","__docgenInfo","subcomponentProps","examples","source","originalSource","ex","stringifyPropType","type","Array","isArray","value","v","JSON","stringify","undefined","arg","defaultValue","required","prop"],"mappings":"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"}